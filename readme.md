# REST API Stock Sederhana
Ini adalah aplikasi REST API sederhana untuk pengelolaan data saham yang dibangun menggunakan GoFiber dengan prinsip Clean Architecture. Aplikasi ini menggunakan PostgreSQL sebagai basis data, dengan GORM sebagai ORM.

## Daftar Isi

- [Jawaban Soal No 2](#jawaban-soal-no-2)
- [Persyaratan](#persyaratan)
- [Instalasi](#instalasi)
- [Struktur Proyek](#struktur-proyek)
- [Skema Basis Data](#skema-basis-data)
- [Konfigurasi](#konfigurasi)
- [Menjalankan Aplikasi](#menjalankan-aplikasi)
- [Pengujian Aplikasi](#pengujian-aplikasi)
- [Endpoint API](#endpoint-api)
    - [Create Stock](#create-stock)
    - [Get Stock by ID](#get-stock-by-id)
    - [Update Stock](#update-stock)
    - [Delete Stock](#delete-stock)
- [Contoh Penggunaan](#contoh-penggunaan)

## Jawaban Soal No 2

### Soal
Anda memiliki program yang mengambil data harga saham setiap 1 detik dan menyimpannya dalam database yang anda buat pada Soal 1. Namun, program tersebut sering mengalami keterlambatan (lag) karena banyaknya permintaan yang masuk. Bagaimana cara mengoptimalkan program tersebut agar dapat menangani lebih banyak permintaan dengan waktu respons yang lebih cepat?

### Jawaban
Untuk mempercepat proses  pengambilan data dan penyimpanan data bisa memanfaatkan fitur concurrency di golang. goroutine bisa digunakan untuk memproses dua proses teresebut secara parallel.
Channel dibutuhkan disini untuk kebutuhan penerimaan dan pengiriman data. Pengambilan data  akan  di proses di  goroutine untuk menyiapkan data yang  sesuai dengan  kebutuhan penyimpanan  di database. Data tersebut dikirim ke channel yang sudah disiapkan, sedangkan goroutine penyimpanan data ke database akan menyimipan data begitu menerima  data dari channel. **Karena  channel proses pengiriman dan penerimaan data melalui channel bersifat blocking**, kita bisa memanfaatkan **buffered channel** dengan jumlah buffer disesuaikan dengan kebutuhan, sehinngga proses pengiriman data di channel akan tetap asynchronous selama masih ada slot di channel.

Caching bisa digunakan tergantung seberapa cepat perubahan data, jika perubahan data tidak teerlalu seering,  kita bisa memanfaatkan metode Chaching, agar proses mengambli data dari service external tidak diperlukan lagi  selama cache belum expired. Jadi ketika ada  permintaan dalam waktu yang singkat tidak prelu lagi mengambil data dari service eexternal.

Load balancng bisa diterapkan jika inifrastruktur mendukung. kita bisa menggunakan load  balancing  secara  vertikal maupun horizontal. jika secara  vertikal tidak memungkinkan kita bisa menerapkannya secara horizontal, dimana kita menambah instance aplikasi untuk menangani banyak peermintaan.

**Namun dari beberapa  solusi diatas**, menurut ada solusi yang lebih baik yaitu dengan menggunakan Event-Driven Architecture. Dimana alih-alih kita mengambil data setiap detik  yang belum tentu ada data pada  saat itu, lebih baik kita mengambil data hanya jika memang benar-benar ada  data baru. kita bisa menggunakan message broker seperti Kafka, RabitMQ, dll unutk mengelola event. Pada opsi ini  event (perubahan data)  dikirimkan ke message  broker. lalu kita menyediakan program worker(subscriber) yang memproses event-tersebut. prosesnya bisa memakai bebrapa pendekatan  di solusi sebelumnya menggunakan goroutine dan  channel. jika data yang diterima perlu diproses terlebih dahulu sebelum disimpan di database  kita bisa memprosesnya di beberapa goroutine dan memanfaatkan channel untuk  komunikasi antar  goroutine.


## Persyaratan

- Go 1.18 atau lebih tinggi
- PostgreSQL 12 atau lebih tinggi
- Docker (opsional)

## Instalasi

1. **Clone repository:**

    ```sh
    $ git clone https://github.com/rydhshlkhn/techtest-mirae.git
    $ cd techtest-mirae
    ```

2. **Atur variabel lingkungan:** Buat file `.env` di direktori root dan tambahkan detail koneksi PostgreSQL:

    ```dotenv
    DATABASE_URL=postgres://mirae-user:mirae-password@db:5432/mirae?sslmode=disable&TimeZone=Asia/Jakarta
    ```

3. **Install Go modules:**

    ```bash
    $ go mod tidy
    ```

4. **Jalankan migrasi:** Skema basis data akan dimigrasi secara otomatis saat aplikasi dijalankan.

## Struktur Proyek

```
techtest-mirae/
├── cmd/
│   └── main.go                     # Application entry point
├── config/
│   └── config.go                   # Configuration management
├── delivery/
│   ├── resthandler/
│   │   ├── stock_delivery.go       # Stock HTTP handler
├── usecase/
│   ├── stock_usecase.go            # Stock business logic
├── repository/
│   ├── stock_reepository.go        # Stock repository interface and implementation
├── mocks/                          # mock inteerface generated by mockery
│   ├── repository 
│   ├── usecase 
├── domain/
│   ├── stock.go                    # Stock entity/model
├── infra/
│   ├── database.go                 # Database connection setup
├── go.mod
└── go.sum
```

## Skema Basis Data

Skema basis data terdiri dari satu tabel utama:

1. **stock**
    
    - `ID` (Primary Key)
    - `Name`
    - `Code`
    - `Price`
    - `Frequency`
    - `Volume`

## Konfigurasi

Konfigurasi dikelola menggunakan variabel lingkungan. File konfigurasi utama berada di `config/config.go`. Pastikan Anda memiliki file `.env` dengan konten berikut:

```dotenv
DATABASE_URL=postgres://mirae-user:mirae-password@db:5432/mirae?sslmode=disable&TimeZone=Asia/Jakarta
```

## Menjalankan Aplikasi

### Menjalankan via Docker
Jika Anda memiliki Docker dan Docker Compose terinstal, Anda dapat menjalankan image dengan perintah berikut:

```bash
$ docker-compose up -d
```
Aplikasi akan berjalan di port 8080 secara default.

### Menjalankan Secara Manual
Anda dapat menjalankan aplikasi dengan perintah berikut:

```bash
$ go run cmd/main.go
```

atau jika ingin menggunakan Makefile, gunakan perintah berikut:

```bash
$ make run
```

Aplikasi akan berjalan di port 8080 secara default.

## Pengujian Aplikasi
Anda dapat menguji aplikasi dengan perintah berikut:

```bash
$ make test
```

## Endpoint API

### Stock
#### **Create Stock:**

- **URL:** `/api/v1/stock`
- **Method:** `POST`
- **Content-Type:** `application/json`
- **Body Example:**
```bash
$ curl -X POST http://localhost:8080/api/v1/stock \
-H "Content-Type: application/json" \
-d '{
    "name": "Mahaka Media Tbk.",
    "code": "ABBX",
    "price": 500,
    "frequency": 1,
    "volume": 1200
}'
```

#### **Retrieve all stocks:**

- **URL:** `/api/v1/stock`
- **Method:** `GET`

```bash
$ curl -X GET http://localhost:8080/api/v1/stock
```

#### **Retrieve stock details by ID:**

- **URL:** `/api/v1/stock/:id`
- **Method:** `GET`
- **URL Params:**
    - `id=[int]` (Stock ID)

```bash
$ curl -X GET http://localhost:8080/api/v1/stock/1
```

#### **Update Stock:**

- **URL:** `/api/v1/stock/:id`
- **Method:** `PUT`
- **Content-Type:** `application/json`
- **Body Example:**
```bash
$ curl -X PUT http://localhost:8080/api/v1/stock \
-H "Content-Type: application/json" \
-d '{
    "name": "Mahaka Media Tbk.",
    "code": "ABBX",
    "price": 500,
    "frequency": 1,
    "volume": 1200
}'
```

#### **Delete stock:**

- **URL:** `/api/v1/stock/:id`
- **Method:** `DELEETE`
- **URL Params:**
    - `id=[int]` (Stock ID)

```bash
$ curl -X GET http://localhost:8080/api/v1/stock/1
```

## Kontribusi

Kontribusi sangat diterima! Silakan fork repository ini dan ajukan pull request untuk perbaikan atau penambahan fitur.
